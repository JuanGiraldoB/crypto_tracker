{% extends "base.html" %}

{% block head %} 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
{% endblock %}

{% block content %}

    
    <!-- Select crypto -->
    <select name="symbol" id="symbol">
        <option>BTCUSDT</option>
        <option>ETHUSDT</option>
        <option>ADAUSDT</option>
        <option>XRPUSDT</option>
    </select>

    <!-- Select interval -->
    <select name="interval" id="interval">
        <option>1D</option>
        <option>4H</option>
        <option>1H</option>
    </select>
    


    <div class="chart-content" style="width: 50vw; max-height: 30vh;">
        <canvas id="myChart" width="400" height="400"></canvas>
    </div>
    <script>
        $(document).ready(function () {
            var data = JSON.parse("{{data|escapejs}}");

            const ctx = document.getElementById('myChart').getContext('2d');
            const myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.date, //date would go here
                    datasets: [{
                        label: data.symbol,
                        data: data.price  //price would go here
                    }]
                },
                
            });
            $('#symbol, #interval').change(function (e) {
                $.ajax({
                    url: '',
                    type: 'GET',
                    data: {
                        symbol: $('#symbol').val(),
                        interval: $('#interval').val()
                    },
                    success: function (response) {
                        myChart.data.datasets[0].label = response.symbol;
                        myChart.data.labels = response.date;
                        myChart.data.datasets[0].data = response.price;
                        myChart.update()
                    }
                })
                e.preventDefault();
            })
        })
    </script>
    {% load static %}
    <!--<script src="{% static 'tracker/js/chart.js' %}"></script> -->
{% endblock %}